"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[205],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>g});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),u=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=u(e.components);return a.createElement(p.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,p=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),c=u(n),m=r,g=c["".concat(p,".").concat(m)]||c[m]||d[m]||s;return n?a.createElement(g,i(i({ref:t},l),{},{components:n})):a.createElement(g,i({ref:t},l))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[c]="string"==typeof e?e:r,i[1]=o;for(var u=2;u<s;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},840:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>u});var a=n(7462),r=(n(7294),n(3905));const s={title:"Guest Users",sidebar_position:2},i=void 0,o={unversionedId:"usage-and-faq/guest_users",id:"usage-and-faq/guest_users",title:"Guest Users",description:"In `FastAPI-Azure-Auth` version 4 and above, guest users in single- and multi-tenant applications (not B2C) will no longer",source:"@site/docs/usage-and-faq/guest_users.mdx",sourceDirName:"usage-and-faq",slug:"/usage-and-faq/guest_users",permalink:"/fastapi-azure-auth/usage-and-faq/guest_users",editUrl:"https://github.com/Intility/FastAPI-Azure-Auth/edit/main/docs/docs/usage-and-faq/guest_users.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Guest Users",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Accessing the user object",permalink:"/fastapi-azure-auth/usage-and-faq/accessing_the_user"},next:{title:"Locking down on roles",permalink:"/fastapi-azure-auth/usage-and-faq/locking_down_on_roles"}},p={},u=[{value:"User assignment required",id:"user-assignment-required",level:3},{value:"Creating a dependency in code",id:"creating-a-dependency-in-code",level:3}],l={toc:u},c="wrapper";function d(e){let{components:t,...s}=e;return(0,r.kt)(c,(0,a.Z)({},l,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"In ",(0,r.kt)("inlineCode",{parentName:"p"},"FastAPI-Azure-Auth")," version 4 and above, guest users in single- and multi-tenant applications (not B2C) will no longer\nbe able to access your APIs by default. Most developers do not intend to give access to guest users which appear\nin the tenant because of other applications (such as users invited into Teams channels), and this can lead to a security\nconcerns if not handled."),(0,r.kt)("p",null,"In single-tenant applications, it is recommended to deny the user on Azure login, instead of after they're calling the APIs,\nplease check out the ",(0,r.kt)("a",{parentName:"p",href:"#user-assignment-required"},"tutorial below"),".\nIn multi-tenant applications, this can be hard to manage, as you'd have to fix this in every tenant."),(0,r.kt)("p",null,"If you want to allow guest users into your tenant, you can change the ",(0,r.kt)("inlineCode",{parentName:"p"},"allow_guest_users")," setting to ",(0,r.kt)("inlineCode",{parentName:"p"},"True"),".\nIf you want to lock down a specific endpoint from guest users, you can do so by creating a\n",(0,r.kt)("a",{parentName:"p",href:"#creating-a-dependency-in-code"},"dependency"),"."),(0,r.kt)("h3",{id:"user-assignment-required"},"User assignment required"),(0,r.kt)("p",null,"Go to ",(0,r.kt)("strong",{parentName:"p"},"all")," your ",(0,r.kt)("a",{parentName:"p",href:"https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/AllApps/menuId/"},"Enterprise Applications"),"\nand do the following steps. You can find your Enterprise Application either by searching on the Client ID in the\n",(0,r.kt)("a",{parentName:"p",href:"https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/AllApps/menuId/"},"Enterprise Applications")," menu,\nor by first navigating to your ",(0,r.kt)("a",{parentName:"p",href:"https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps"},"App registration")," and\nclicking the ",(0,r.kt)("inlineCode",{parentName:"p"},"Managed application in local directory")," link:"),(0,r.kt)("p",null,(0,r.kt)("img",{loading:"lazy",alt:"guest_1_link_from_appreg",src:n(3764).Z,width:"1980",height:"400"})),(0,r.kt)("p",null,"Under ",(0,r.kt)("strong",{parentName:"p"},"Properties"),", enable ",(0,r.kt)("inlineCode",{parentName:"p"},"User assignment required?")," and ",(0,r.kt)("strong",{parentName:"p"},"Save"),"."),(0,r.kt)("p",null,"Then, go to ",(0,r.kt)("strong",{parentName:"p"},"Users and groups"),", and ",(0,r.kt)("strong",{parentName:"p"},"add user/group"),". Find users or a fitting group and assign it to the role Default Access."),(0,r.kt)("h3",{id:"creating-a-dependency-in-code"},"Creating a dependency in code"),(0,r.kt)("p",null,"Sometimes, especially for multi-tenant applications, doing in-code checks are beneficial. Please note that guest\nusers are denied by default, so you only need this if you configure ",(0,r.kt)("inlineCode",{parentName:"p"},"allow_guest_users")," setting to ",(0,r.kt)("inlineCode",{parentName:"p"},"True"),", but\nwould like to lock down specific endpoints."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="security.py"',title:'"security.py"'},'from fastapi import Depends\nfrom fastapi_azure_auth.exceptions import InvalidAuth\nfrom fastapi_azure_auth.user import User\n\nasync def deny_guest_users(user: User = Depends(azure_scheme)) -> None:\n    """\n    Deny guest users\n    """\n    if user.is_guest:\n        raise InvalidAuth(\'Guest user not allowed\')\n')),(0,r.kt)("p",null,"Alternatively, after ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/tiangolo/fastapi/releases/tag/0.95.0"},"FastAPI 0.95.0")," you can create an\n",(0,r.kt)("inlineCode",{parentName:"p"},"Annotated")," dependency."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="security.py"',title:'"security.py"'},'from typing import Annotated\nfrom fastapi import Depends\nfrom fastapi_azure_auth.exceptions import InvalidAuth\nfrom fastapi_azure_auth.user import User\n\nasync def deny_guest_users(user: User = Depends(azure_scheme)) -> None:\n    """\n    Deny guest users\n    """\n    if user.is_guest:\n        raise InvalidAuth(\'Guest user not allowed\')\n\nNonGuestUser = Annotated[User, Depends(deny_guest_users)]\n')),(0,r.kt)("p",null,"and in your view:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="my_view.py"',title:'"my_view.py"'},'@app.get("/items/")\ndef read_items(user: NonGuestUser):\n    ...\n')),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can configure the ",(0,r.kt)("inlineCode",{parentName:"p"},"acct")," claim in AzureAD if you'd like a specific claim to indicate if the user\nis a guest or tenant member"))))}d.isMDXComponent=!0},3764:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/guest_1_link_from_appreg-f3f5fda78fb5cb79bb78b786b48edc9e.png"}}]);