"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[568],{7316:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var t=s(4848),a=s(8453);const i={title:"Locking down on roles",sidebar_position:3},r=void 0,o={id:"usage-and-faq/locking_down_on_roles",title:"Locking down on roles",description:"Azure setup",source:"@site/docs/usage-and-faq/locking_down_on_roles.mdx",sourceDirName:"usage-and-faq",slug:"/usage-and-faq/locking_down_on_roles",permalink:"/fastapi-azure-auth/usage-and-faq/locking_down_on_roles",draft:!1,unlisted:!1,editUrl:"https://github.com/Intility/FastAPI-Azure-Auth/edit/main/docs/docs/usage-and-faq/locking_down_on_roles.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Locking down on roles",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Guest Users",permalink:"/fastapi-azure-auth/usage-and-faq/guest_users"},next:{title:"Calling your APIs from Python",permalink:"/fastapi-azure-auth/usage-and-faq/calling_your_apis_from_python"}},d={},c=[{value:"Azure setup",id:"azure-setup",level:2},{value:"App code",id:"app-code",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"azure-setup",children:"Azure setup"}),"\n",(0,t.jsxs)(n.p,{children:["Go to your application registration, click ",(0,t.jsx)(n.code,{children:"Groups"}),":\n",(0,t.jsx)(n.img,{alt:"manifest",src:s(9974).A+"",width:"301",height:"635"})]}),"\n",(0,t.jsxs)(n.p,{children:["Create a role:\n",(0,t.jsx)(n.img,{alt:"manifest",src:s(1213).A+"",width:"580",height:"506"})]}),"\n",(0,t.jsxs)(n.p,{children:["Go to Overview and click the Enterprise application link:\n",(0,t.jsx)(n.img,{alt:"manifest",src:s(84).A+"",width:"1678",height:"392"})]}),"\n",(0,t.jsxs)(n.p,{children:["Go to ",(0,t.jsx)(n.code,{children:"Users and groups"})," and add a user/group:\n",(0,t.jsx)(n.img,{alt:"manifest",src:s(5995).A+"",width:"379",height:"390"})]}),"\n",(0,t.jsxs)(n.p,{children:["Add the user/group that you want to have this role (if you use a group, the users must be a direct member of that group. Nested membership does not work):\n",(0,t.jsx)(n.img,{alt:"manifest",src:s(4866).A+"",width:"599",height:"1205"})]}),"\n",(0,t.jsxs)(n.p,{children:["Click ",(0,t.jsx)(n.code,{children:"select role"})," and assign the user/role to your application role:\n",(0,t.jsx)(n.img,{alt:"manifest",src:s(3049).A+"",width:"296",height:"612"})]}),"\n",(0,t.jsxs)(n.p,{children:["Finish by clicking ",(0,t.jsx)(n.code,{children:"Assign"}),". The user will now have that group in their token."]}),"\n",(0,t.jsx)(n.h2,{id:"app-code",children:"App code"}),"\n",(0,t.jsx)(n.p,{children:"You can lock down on roles by creating your own wrapper dependency:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="dependencies.py"',children:'from fastapi import Depends\nfrom fastapi_azure_auth.exceptions import InvalidAuth\nfrom fastapi_azure_auth.user import User\n\nasync def validate_is_admin_user(user: User = Depends(azure_scheme)) -> None:\n    """\n    Validate that a user is in the `AdminUser` role in order to access the API.\n    Raises a 401 authentication error if not.\n    """\n    if \'AdminUser\' not in user.roles:\n        raise InvalidAuth(\'User is not an AdminUser\')\n'})}),"\n",(0,t.jsxs)(n.p,{children:["and then use this dependency over ",(0,t.jsx)(n.code,{children:"azure_scheme"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Alternatively, after ",(0,t.jsx)(n.a,{href:"https://github.com/tiangolo/fastapi/releases/tag/0.95.0",children:"FastAPI 0.95.0"})," you can create an\n",(0,t.jsx)(n.code,{children:"Annotated"})," dependency."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="security.py"',children:'from typing import Annotated\nfrom fastapi import Depends\nfrom fastapi_azure_auth.exceptions import InvalidAuth\nfrom fastapi_azure_auth.user import User\n\nasync def validate_is_admin_user(user: User = Depends(azure_scheme)) -> None:\n    """\n    Validate that a user is in the `AdminUser` role in order to access the API.\n    Raises a 401 authentication error if not.\n    """\n    if \'AdminUser\' not in user.roles:\n        raise InvalidAuth(\'User is not an AdminUser\')\n\nAdminUser = Annotated[User, Depends(validate_is_admin_user)]\n'})}),"\n",(0,t.jsx)(n.p,{children:"and in your view:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="my_view.py"',children:'@app.get("/items/")\ndef read_items(user: AdminUser):\n    ...\n'})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},9974:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/role_1-1d8214ae0485ad4da3add1fa2933977a.png"},1213:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/role_2-453b6175f5be07285deea80af2d6a9a3.png"},84:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/role_3-c7f381e26e676ec964ac34635b03a1f8.png"},5995:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/role_4-8aeba628977ee3ffb2a39f6aa4efe8db.png"},4866:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/role_5-5678faac6d5b106d43133f3c447fdfcb.png"},3049:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/role_6-2b5463ce35eb34ce4c36ea3a44653a92.png"},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var t=s(6540);const a={},i=t.createContext(a);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);